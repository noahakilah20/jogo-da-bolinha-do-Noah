<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo da Bolinha do Noah</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background-color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
      color: white;
    }
    canvas {
      border: 2px solid white;
      background-color: #222;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="500" height="600"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let balls = [{ x: 250, y: 500, dx: 3, dy: -3, radius: 7, launched: false }];
let paddle = { x: 220, width: 60, height: 10 };
let bricks = [];
let rows = 4;
let cols = 7;
let brickWidth = 60;
let brickHeight = 20;
let spacing = 5;
let score = 0;
let lives = 3;
let level = 1;
let maxLevel = 3;
let arrowAngle = Math.PI / 4;
let showArrow = true;
let timer = 0;
let startTime = null;

function resetBricks() {
  bricks = [];
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      let x = 50 + c * (brickWidth + spacing);
      let y = 50 + r * (brickHeight + spacing);
      bricks.push({ x, y, hits: 0 });
    }
  }
}

function drawBall(ball) {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();
  ctx.closePath();
}

function drawPaddle() {
  ctx.fillStyle = "blue";
  ctx.fillRect(paddle.x, canvas.height - paddle.height - 10, paddle.width, paddle.height);
}

function drawBricks() {
  bricks.forEach(brick => {
    if (brick.hits < 3) {
      if (brick.hits === 0) ctx.fillStyle = "#0f0";
      else if (brick.hits === 1) ctx.fillStyle = "#cc0";
      else ctx.fillStyle = "#c30";
      ctx.fillRect(brick.x, brick.y, brickWidth, brickHeight);
    }
  });
}

function drawInfo() {
  ctx.fillStyle = "white";
  ctx.font = "14px Arial";
  ctx.fillText(`Fase: ${level} | Pontos: ${score} | Vidas: ${lives} | Tempo: ${Math.floor(timer)}s`, 10, 20);
}

function drawArrow(ball) {
  if (!ball.launched && showArrow) {
    ctx.save();
    ctx.translate(ball.x, ball.y);
    ctx.rotate(arrowAngle);
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(0, -40);
    ctx.lineTo(-5, -30);
    ctx.moveTo(0, -40);
    ctx.lineTo(5, -30);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  balls.forEach(drawBall);
  drawPaddle();
  drawBricks();
  drawInfo();
  drawArrow(balls[0]);
}

function update() {
  if (balls.some(b => b.launched)) {
    if (!startTime) startTime = Date.now();
    timer = (Date.now() - startTime) / 1000;
  }

  balls.forEach((ball, index) => {
    if (ball.launched) {
      ball.x += ball.dx;
      ball.y += ball.dy;

      if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) ball.dx *= -1;
      if (ball.y - ball.radius < 0) ball.dy *= -1;

      if (ball.y + ball.radius >= canvas.height - paddle.height - 10 &&
          ball.x >= paddle.x && ball.x <= paddle.x + paddle.width) {
        ball.dy *= -1;
      }

      if (ball.y > canvas.height) {
        balls.splice(index, 1);
        if (balls.length === 0) {
          lives--;
          if (lives === 0) {
            alert("Game Over!");
            document.location.reload();
          } else {
            resetBall();
          }
        }
      }

      bricks.forEach(brick => {
        if (brick.hits < 3 &&
            ball.x > brick.x && ball.x < brick.x + brickWidth &&
            ball.y > brick.y && ball.y < brick.y + brickHeight) {
          ball.dy *= -1;
          brick.hits++;
          if (brick.hits === 3) score += 10;
          if (brick.hits === 3) {
            balls.push({ x: ball.x, y: ball.y, dx: -ball.dx, dy: -ball.dy, radius: 7, launched: true });
          }
        }
      });
    }
  });

  if (bricks.every(b => b.hits === 3)) {
    if (level < maxLevel) {
      level++;
      rows++;
      score += 50;
      resetBall();
      resetBricks();
    } else {
      alert("Parabéns! Você venceu o jogo!");
      document.location.reload();
    }
  }
  draw();
  requestAnimationFrame(update);
}

function resetBall() {
  balls = [{ x: canvas.width / 2, y: 500, dx: 3, dy: -3, radius: 7, launched: false }];
  showArrow = true;
  startTime = null;
  timer = 0;
}

canvas.addEventListener("mousemove", e => {
  let rect = canvas.getBoundingClientRect();
  let mouseX = e.clientX - rect.left;
  paddle.x = mouseX - paddle.width / 2;
});

canvas.addEventListener("click", () => {
  if (!balls[0].launched) {
    balls[0].launched = true;
    showArrow = false;
  }
});

resetBricks();
update();
</script>
</body>
</html>
