<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo da Bolinha do Noah</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: #222;
      display: block;
      margin-top: 10px;
      border: 2px solid #fff;
    }
    #info {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #startScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 50px;
    }
    #startScreen input {
      padding: 10px;
      margin-bottom: 10px;
    }
    #arrow {
      position: absolute;
      width: 40px;
      height: 40px;
      border: solid white;
      border-width: 0 5px 5px 0;
      transform: rotate(-45deg);
      top: 200px;
      left: 50%;
      margin-left: -20px;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: rotate(-45deg) translateY(0); }
      50% { transform: rotate(-45deg) translateY(-10px); }
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <input type="text" id="playerName" placeholder="Digite seu nome ou ID" />
    <button onclick="startGame()">Come√ßar Jogo</button>
    <div id="arrow"></div>
  </div>
  <canvas id="gameCanvas" width="800" height="600" style="display: none;"></canvas>
  <div id="info"></div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const info = document.getElementById("info");
    const startScreen = document.getElementById("startScreen");
    const arrow = document.getElementById("arrow");

    let playerName = "";
    let ballSpeed = 4;
    let score = 0;
    let lives = 3;
    let bricks = [];
    let balls = [];
    let phase = 1;
    let timeStart = null;

    const paddle = {
      x: canvas.width / 2 - 50,
      y: canvas.height - 20,
      width: 100,
      height: 10,
      dx: 6
    };

    function createBricks(rows, cols) {
      bricks = [];
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          bricks.push({
            x: c * 75 + 35,
            y: r * 30 + 40,
            width: 70,
            height: 20,
            hits: 0,
            destroyed: false
          });
        }
      }
    }

    function drawBricks() {
      bricks.forEach(b => {
        if (!b.destroyed) {
          ctx.fillStyle = ["#FF595E", "#FFCA3A", "#8AC926"][b.hits % 3];
          ctx.fillRect(b.x, b.y, b.width, b.height);
        }
      });
    }

    function drawPaddle() {
      ctx.fillStyle = "white";
      ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
    }

    function drawBalls() {
      balls.forEach(ball => {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "#00f0ff";
        ctx.fill();
        ctx.closePath();
      });
    }

    function updateBalls() {
      balls.forEach((ball, index) => {
        ball.x += ball.dx;
        ball.y += ball.dy;

        // Parede
        if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) ball.dx *= -1;
        if (ball.y - ball.radius < 0) ball.dy *= -1;

        // Paddle
        if (
          ball.y + ball.radius > paddle.y &&
          ball.x > paddle.x &&
          ball.x < paddle.x + paddle.width
        ) {
          ball.dy *= -1;
        }

        // Fora da tela
        if (ball.y - ball.radius > canvas.height) {
          balls.splice(index, 1);
          if (balls.length === 0) {
            lives--;
            if (lives > 0) resetBall();
            else resetGame();
          }
        }

        // Tijolos
        bricks.forEach(brick => {
          if (!brick.destroyed &&
              ball.x > brick.x && ball.x < brick.x + brick.width &&
              ball.y > brick.y && ball.y < brick.y + brick.height
          ) {
            ball.dy *= -1;
            brick.hits++;
            score += 10;
            if (brick.hits === 3) {
              brick.destroyed = true;
              balls.push({ ...ball });
            }
          }
        });
      });
    }

    function drawInfo() {
      const timeElapsed = ((Date.now() - timeStart) / 1000).toFixed(1);
      info.innerHTML = `Jogador: ${playerName} | Pontos: ${score} | Vidas: ${lives} | Tempo: ${timeElapsed}s | Fase: ${phase}`;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPaddle();
      drawBricks();
      drawBalls();
      drawInfo();
      updateBalls();
      requestAnimationFrame(draw);

      if (bricks.every(b => b.destroyed) || (phase === 1 && score >= 300) || (phase === 2 && score >= 600)) {
        nextPhase();
      }
    }

    function resetBall() {
      balls = [{ x: canvas.width / 2, y: 300, radius: 7, dx: ballSpeed, dy: -ballSpeed }];
    }

    function resetGame() {
      phase = 1;
      score = 0;
      lives = 3;
      ballSpeed = 4;
      createBricks(3, 7);
      resetBall();
      timeStart = Date.now();
    }

    function nextPhase() {
      phase++;
      if (phase > 3) return;
      ballSpeed += 1;
      createBricks(phase + 2, 6 + phase);
      resetBall();
    }

    function movePaddle(e) {
      const key = e.key;
      if (key === "ArrowLeft") paddle.x -= paddle.dx;
      else if (key === "ArrowRight") paddle.x += paddle.dx;
    }

    function movePaddleTouch(evt) {
      const touchX = evt.touches[0].clientX;
      const canvasRect = canvas.getBoundingClientRect();
      paddle.x = touchX - canvasRect.left - paddle.width / 2;
    }

    function startGame() {
      playerName = document.getElementById("playerName").value.trim() || "Jogador";
      startScreen.style.display = "none";
      canvas.style.display = "block";
      resetGame();
      draw();
    }

    document.addEventListener("keydown", movePaddle);
    canvas.addEventListener("touchmove", movePaddleTouch);
  </script>
</body>
</html>
