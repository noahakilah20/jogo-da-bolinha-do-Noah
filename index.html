<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo da Bolinha do Noah</title>
  <style>
    body {
      margin: 0;
      background-color: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      background-color: #222;
      border: 2px solid #fff;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const paddle = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 20,
      width: 80,
      height: 10,
      dx: 5
    };

    const ball = {
      x: canvas.width / 2,
      y: canvas.height - 30,
      radius: 6,
      speed: 4,
      dx: 4 * (Math.random() < 0.5 ? 1 : -1),
      dy: -4
    };

    const brickRowCount = 5;
    const brickColumnCount = 7;
    const brickWidth = 50;
    const brickHeight = 20;
    const brickPadding = 5;
    const brickOffsetTop = 40;
    const brickOffsetLeft = 20;
    let bricks = [];

    let score = 0;
    let lives = 3;
    let currentPhase = 1;
    let arrowAngle = -Math.PI / 4;
    let gameStarted = false;

    function createBricks() {
      bricks = [];
      for (let c = 0; c < brickColumnCount; c++) {
        for (let r = 0; r < brickRowCount; r++) {
          bricks.push({
            x: c * (brickWidth + brickPadding) + brickOffsetLeft,
            y: r * (brickHeight + brickPadding) + brickOffsetTop,
            hits: 3,
            destroyed: false
          });
        }
      }
    }

    function drawPaddle() {
      ctx.fillStyle = "#00f";
      ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.fill();
      ctx.closePath();
    }

    function drawBricks() {
      bricks.forEach(b => {
        if (!b.destroyed) {
          ctx.fillStyle = `rgb(${255 - b.hits * 60}, ${b.hits * 80}, 0)`;
          ctx.fillRect(b.x, b.y, brickWidth, brickHeight);
        }
      });
    }

    function drawScore() {
      ctx.fillStyle = "#fff";
      ctx.font = "14px Arial";
      ctx.fillText(`Fase: ${currentPhase} | Pontos: ${score} | Vidas: ${lives}`, 10, 20);
    }

    function drawArrow() {
      if (!gameStarted) {
        ctx.strokeStyle = "#0f0";
        ctx.beginPath();
        ctx.moveTo(ball.x, ball.y);
        ctx.lineTo(ball.x + 50 * Math.cos(arrowAngle), ball.y + 50 * Math.sin(arrowAngle));
        ctx.stroke();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBricks();
      drawPaddle();
      drawBall();
      drawScore();
      drawArrow();
    }

    function moveBall() {
      ball.x += ball.dx;
      ball.y += ball.dy;

      // Colisão com parede
      if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) ball.dx *= -1;
      if (ball.y - ball.radius < 0) ball.dy *= -1;

      // Colisão com paddle
      if (
        ball.x > paddle.x &&
        ball.x < paddle.x + paddle.width &&
        ball.y + ball.radius > paddle.y
      ) {
        ball.dy = -ball.speed;
      }

      // Colisão com chão
      if (ball.y + ball.radius > canvas.height) {
        lives--;
        if (lives === 0) {
          alert("Game Over!");
          document.location.reload();
        } else {
          resetBall();
        }
      }

      // Colisão com tijolos
      bricks.forEach(b => {
        if (!b.destroyed) {
          if (
            ball.x > b.x &&
            ball.x < b.x + brickWidth &&
            ball.y - ball.radius < b.y + brickHeight &&
            ball.y + ball.radius > b.y
          ) {
            ball.dy *= -1;
            b.hits--;
            if (b.hits <= 0) {
              b.destroyed = true;
              score += 10;
            }
          }
        }
      });

      // Fim da fase
      if (bricks.every(b => b.destroyed)) {
        if (currentPhase === 3) {
          alert("Parabéns! Você venceu!");
          document.location.reload();
        } else {
          currentPhase++;
          ball.speed += 1;
          resetBall();
          createBricks();
        }
      }
    }

    function movePaddle() {
      document.addEventListener("mousemove", e => {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        paddle.x = mouseX - paddle.width / 2;
      });
    }

    function resetBall() {
      ball.x = canvas.width / 2;
      ball.y = canvas.height - 30;
      ball.dx = ball.speed * (Math.random() < 0.5 ? 1 : -1);
      ball.dy = -ball.speed;
      gameStarted = false;
    }

    function update() {
      if (gameStarted) moveBall();
      draw();
      requestAnimationFrame(update);
    }

    canvas.addEventListener("click", () => {
      if (!gameStarted) {
        ball.dx = ball.speed * Math.cos(arrowAngle);
        ball.dy = ball.speed * Math.sin(arrowAngle);
        gameStarted = true;
      }
    });

    document.addEventListener("keydown", e => {
      if (!gameStarted) {
        if (e.key === "ArrowLeft") arrowAngle -= 0.1;
        if (e.key === "ArrowRight") arrowAngle += 0.1;
      }
    });

    createBricks();
    movePaddle();
    update();
  </script>
</body>
</html>
